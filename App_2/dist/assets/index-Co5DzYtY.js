import{r as x,a as Ee,R as Ce}from"./react-nf7bT_Uh.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(r){if(r.ep)return;r.ep=!0;const l=a(r);fetch(r.href,l)}})();var be={exports:{}},te={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Be=x,Se=Symbol.for("react.element"),Ge=Symbol.for("react.fragment"),Le=Object.prototype.hasOwnProperty,Re=Be.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Oe={key:!0,ref:!0,__self:!0,__source:!0};function Te(t,e,a){var o,r={},l=null,i=null;a!==void 0&&(l=""+a),e.key!==void 0&&(l=""+e.key),e.ref!==void 0&&(i=e.ref);for(o in e)Le.call(e,o)&&!Oe.hasOwnProperty(o)&&(r[o]=e[o]);if(t&&t.defaultProps)for(o in e=t.defaultProps,e)r[o]===void 0&&(r[o]=e[o]);return{$$typeof:Se,type:t,key:l,ref:i,props:r,_owner:Re.current}}te.Fragment=Ge;te.jsx=Te;te.jsxs=Te;be.exports=te;var s=be.exports,ae={},ge=Ee;ae.createRoot=ge.createRoot,ae.hydrateRoot=ge.hydrateRoot;/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Me=(...t)=>t.filter((e,a,o)=>!!e&&o.indexOf(e)===a).join(" ");/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var De={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=x.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:a=2,absoluteStrokeWidth:o,className:r="",children:l,iconNode:i,...y},m)=>x.createElement("svg",{ref:m,...De,width:e,height:e,stroke:t,strokeWidth:o?Number(a)*24/Number(e):a,className:Me("lucide",r),...y},[...i.map(([b,p])=>x.createElement(b,p)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=(t,e)=>{const a=x.forwardRef(({className:o,...r},l)=>x.createElement(We,{ref:l,iconNode:e,className:Me(`lucide-${$e(t)}`,o),...r}));return a.displayName=`${t}`,a};/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=W("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=W("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=W("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=W("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=W("Layers3",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m6.08 9.5-3.5 1.6a1 1 0 0 0 0 1.81l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9a1 1 0 0 0 0-1.83l-3.5-1.59",key:"1e5n1m"}],["path",{d:"m6.08 14.5-3.5 1.6a1 1 0 0 0 0 1.81l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9a1 1 0 0 0 0-1.83l-3.5-1.59",key:"1iwflc"}]]);/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=W("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=W("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=W("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=W("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.451.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=W("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function q({className:t="",variant:e="default",size:a="sm",...o}){return s.jsx("button",{className:`inline-flex items-center gap-2 rounded-2xl text-sm font-medium shadow-sm transition active:scale-[.98]
        ${a==="sm"?"px-3 py-1.5":a==="lg"?"px-5 py-3":"px-4 py-2"}
        ${e==="default"?"bg-slate-900 text-white hover:bg-slate-800":""}
        ${e==="ghost"?"bg-transparent hover:bg-slate-100":""}
        ${e==="outline"?"border border-slate-300 hover:bg-slate-50":""}
        ${t}`,...o})}function Ke(){return s.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs",children:[s.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs bg-emerald-100 text-emerald-700",children:[s.jsx("span",{className:"h-2 w-2 rounded-full bg-emerald-500 inline-block"})," Activo"]}),s.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs bg-amber-100 text-amber-800",children:[s.jsx("span",{className:"h-2 w-2 rounded-full bg-amber-500 inline-block"})," Standby / Regulación"]}),s.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs bg-rose-100 text-rose-700",children:[s.jsx("span",{className:"h-2 w-2 rounded-full bg-rose-600 inline-block"})," Falla / Cerrado"]}),s.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs bg-sky-100 text-sky-700",children:[s.jsx("span",{className:"h-2 w-2 rounded-full bg-sky-600 inline-block"})," Flujo"]}),s.jsx("span",{className:"text-[10px] text-slate-500",children:"Grosor de línea ≈ diámetro"})]})}function Ae(t){var f,C,$,_,E,N,V,I,G,K,z,n,c,h,k,A,v,B,L,R,D,H,X,j,J,Z,Q,re,le,ie,ce,de,ue,xe,me,pe,he,fe;const e=new Map(t.map(d=>[d.id,d])),a={plant:140,manifold:300,branches:500,outValves:660,principals:860,highValves:1020,highTanks:1180,eastPumps:940,eastManifold:1080},o=80,r=60,l=["P1","P2","P3","P4","P5","P6","P7"].filter(d=>e.has(d)),i=["P10","P11","P12"].filter(d=>e.has(d)),y=["VTA1","VTA2","VTA3"].filter(d=>e.has(d)),m=["TA1","TA2","TA3"].filter(d=>e.has(d)),b=o+r*Math.max(l.length-1,0),p=Math.round((o+b)/2);l.forEach((d,w)=>{const u=e.get(d);u.x??(u.x=a.plant),u.y??(u.y=o+r*w)}),e.get("MC")&&((f=e.get("MC")).x??(f.x=a.manifold),(C=e.get("MC")).y??(C.y=p)),e.get("M8")&&(($=e.get("M8")).x??($.x=a.branches),(_=e.get("M8")).y??(_.y=p-80)),e.get("M10")&&((E=e.get("M10")).x??(E.x=a.branches),(N=e.get("M10")).y??(N.y=p+60)),e.get("V8")&&((V=e.get("V8")).x??(V.x=a.outValves),(G=e.get("V8")).y??(G.y=((I=e.get("M8"))==null?void 0:I.y)??p-80)),e.get("V10")&&((K=e.get("V10")).x??(K.x=a.outValves),(n=e.get("V10")).y??(n.y=((z=e.get("M10"))==null?void 0:z.y)??p+60)),e.get("TP")&&((c=e.get("TP")).x??(c.x=a.principals),(h=e.get("TP")).y??(h.y=p-40)),e.get("TA")&&((k=e.get("TA")).x??(k.x=a.principals),(A=e.get("TA")).y??(A.y=p+120));const O=60,T=26,g=18,F=a.principals-(O+g+T);e.get("P8")&&((v=e.get("P8")).x??(v.x=F),(L=e.get("P8")).y??(L.y=((B=e.get("TP"))==null?void 0:B.y)??p-40)),e.get("P9")&&((R=e.get("P9")).x??(R.x=F),(H=e.get("P9")).y??(H.y=((D=e.get("TA"))==null?void 0:D.y)??p+120)),e.get("MB")&&((X=e.get("MB")).x??(X.x=a.highValves),(J=e.get("MB")).y??(J.y=((j=e.get("TP"))==null?void 0:j.y)??p));const M=(((Z=e.get("TP"))==null?void 0:Z.y)??220)-140,Y=60;if(y.forEach((d,w)=>{const u=e.get(d);u.x??(u.x=a.highValves),u.y??(u.y=M+Y*w)}),m.forEach((d,w)=>{var ye;const u=e.get(d);u.x??(u.x=a.highTanks);const S="V"+d;u.y??(u.y=((ye=e.get(S))==null?void 0:ye.y)??M+Y*w)}),e.get("VG")&&((Q=e.get("VG")).x??(Q.x=a.highValves),(le=e.get("VG")).y??(le.y=((re=e.get("TA"))==null?void 0:re.y)??p+120)),e.get("TG")&&((ie=e.get("TG")).x??(ie.x=a.highTanks),(de=e.get("TG")).y??(de.y=(((ce=e.get("VG"))==null?void 0:ce.y)??p+120)+80)),i.length){const d=(((ue=e.get("TA"))==null?void 0:ue.y)??380)+140;if(i.forEach((w,u)=>{const S=e.get(w);S.x??(S.x=a.eastPumps),S.y??(S.y=d+u*60)}),e.has("ME")){const w=e.get("ME");w.x??(w.x=a.eastManifold);const u=((xe=e.get(i[0]))==null?void 0:xe.y)??d,S=((me=e.get(i[i.length-1]))==null?void 0:me.y)??d;w.y??(w.y=Math.round((u+S)/2))}}if(e.has("MTAH")){const d=e.get("MTAH"),w=((pe=e.get("VTA2"))==null?void 0:pe.y)??Math.round(((((he=e.get("TA1"))==null?void 0:he.y)??M)+(((fe=e.get("TA3"))==null?void 0:fe.y)??M+2*Y))/2);if(d.x??(d.x=a.highValves),d.y??(d.y=w),e.has("PB")){const u=e.get("PB"),S=a.highValves-(O+g+T);u.x??(u.x=S),u.y??(u.y=d.y)}}return t.map(d=>({...d,x:d.x??e.get(d.id).x,y:d.y??e.get(d.id).y}))}const je=[{id:"TA1",type:"tank",name:"Tanque Alto 1",level:.42,capacity:600},{id:"TA2",type:"tank",name:"Tanque Alto 2",level:.33,capacity:550},{id:"TA3",type:"tank",name:"Tanque Alto 3",level:.37,capacity:520},{id:"TP",type:"tank",name:"Tanque Pulmón",level:.55,capacity:1500},{id:"TA",type:"tank",name:"Tanque Almacén",level:.68,capacity:1800},{id:"TG",type:"tank",name:"Tanque Gravedad",level:.61,capacity:700},{id:"P1",type:"pump",name:"Bomba P1",status:"on",kW:22},{id:"P2",type:"pump",name:"Bomba P2",status:"on",kW:22},{id:"P3",type:"pump",name:"Bomba P3",status:"standby",kW:22},{id:"P4",type:"pump",name:"Bomba P4",status:"on",kW:22},{id:"P5",type:"pump",name:"Bomba P5",status:"standby",kW:22},{id:"P6",type:"pump",name:"Bomba P6",status:"on",kW:22},{id:"P7",type:"pump",name:"Bomba P7",status:"fault",kW:22},{id:"MC",type:"manifold",name:"Colectora Planta"},{id:"M8",type:"manifold",name:'Colectora Ø8"'},{id:"M10",type:"manifold",name:'Colectora Ø10"'},{id:"V8",type:"valve",name:"V-Ø8",state:"open"},{id:"V10",type:"valve",name:"V-Ø10",state:"open"},{id:"P8",type:"pump",name:"Bomba P8 (Pulmón)",status:"on",kW:18},{id:"P9",type:"pump",name:"Bomba P9 (Pulmón)",status:"standby",kW:18},{id:"MB",type:"manifold",name:"Colectora Pulmón"},{id:"VTA1",type:"valve",name:"V-TA1",state:"open"},{id:"VTA2",type:"valve",name:"V-TA2",state:"open"},{id:"VTA3",type:"valve",name:"V-TA3",state:"throttle"},{id:"VG",type:"valve",name:"V-Gravedad",state:"open"},{id:"P10",type:"pump",name:"Bomba P10 (Planta Este)",status:"on",kW:18},{id:"P11",type:"pump",name:"Bomba P11 (Planta Este)",status:"standby",kW:18},{id:"P12",type:"pump",name:"Bomba P12 (Planta Este)",status:"standby",kW:18},{id:"ME",type:"manifold",name:"Colectora Planta Este"},{id:"MTAH",type:"manifold",name:"Colectora Tanques Altos"},{id:"PB",type:"pump",name:"Bomba Colectora Altos",status:"standby",kW:15}],U=Ae(je),Ze=[["P1","MC"],["P2","MC"],["P3","MC"],["P4","MC"],["P5","MC"],["P6","MC"],["P7","MC"],["MC","M8","8"],["MC","M10","10"],["M8","V8","8"],["M10","V10","10"],["V8","TP","8"],["V10","TA","10"],["TP","P8"],["TP","P9"],["P8","MB"],["P9","MB"],["MB","VTA1"],["MB","VTA2"],["MB","VTA3"],["VTA1","TA1"],["VTA2","TA2"],["VTA3","TA3"],["TA","VG","G"],["VG","TG","G"],["P10","ME"],["P11","ME"],["P12","ME"],["ME","TG","10"],["TA1","MTAH"],["TA2","MTAH"],["TA3","MTAH"],["MTAH","PB"]],oe={Normal:{active:["MC>M8","M8>V8","V8>TP","MC>M10","M10>V10","V10>TA","TP>P8","P8>MB","MB>VTA1","MB>VTA2","MB>VTA3","VTA1>TA1","VTA2>TA2","VTA3>TA3","TA>VG","VG>TG","P10>ME","ME>TG"],note:"Ø8→Pulmón, Ø10→Almacén. P8 impulsa a VTA1/2/3. P10 apoya a TG."},"Pulmón dual":{active:["MC>M8","M8>V8","V8>TP","MC>M10","M10>V10","V10>TA","TP>P8","TP>P9","P8>MB","P9>MB","MB>VTA1","MB>VTA2","MB>VTA3","VTA1>TA1","VTA2>TA2","VTA3>TA3","TA>VG","VG>TG","P10>ME","ME>TG"],note:"P8 y P9 alimentan colectora; Planta Este apoya TG."},"Sólo Ø8":{active:["MC>M8","M8>V8","V8>TP","TP>P8","P8>MB","MB>VTA1","MB>VTA2","MB>VTA3","VTA1>TA1","VTA2>TA2","VTA3>TA3","P10>ME","ME>TG"],note:"Ø10 fuera; Pulmón con P8 → VTA1/2/3. TG con Planta Este."},"Sólo Ø10":{active:["MC>M10","M10>V10","V10>TA","TA>VG","VG>TG","P10>ME","ME>TG"],note:"Ø8 fuera; Almacén y Planta Este sostienen."},Emergencia:{active:["MC>M8","M8>V8","V8>TP","TP>P9","P9>MB","MB>VTA3","VTA3>TA3","MC>M10","M10>V10","V10>TA","P10>ME","ME>TG"],note:"Falla P8: P9 prioriza TA3. Ø10 sostiene Almacén. Planta Este mantiene TG."}},P=Object.fromEntries(U.map(t=>[t.id,t]));function Qe(t,e){return`${t}>${e}`}function et(t,e){const a=P[t],o=P[e],r=(a.x+o.x)/2;return`M ${a.x} ${a.y} L ${r} ${a.y} L ${r} ${o.y} L ${o.x} ${o.y}`}function tt(t){return x.useMemo(()=>{const e=oe[t].active,a=new Set(e);return Ze.map(([o,r,l])=>({a:o,b:r,pipe:l??void 0,active:a.has(Qe(o,r))}))},[t])}function st({a:t,b:e,pipe:a,active:o}){const r=P[t],l=P[e];if(!r||!l)return null;const i=et(t,e),y=a==="10"?4:a==="8"?3.5:3,m=a==="10"?'Ø10"':a==="8"?'Ø8"':a==="G"?"Gravedad":"",b=(r.x+l.x)/2,p=(r.y+l.y)/2-6;return s.jsxs("g",{children:[s.jsx("path",{d:i,className:`${o?"stroke-sky-600 flowing":"stroke-slate-300"}`,style:{strokeWidth:y,fill:"none"},markerEnd:"url(#arrow)"}),m&&s.jsx("text",{x:b,y:p,textAnchor:"middle",className:"fill-slate-500 text-[10px]",children:m})]})}function nt({x:t,y:e,w:a,h:o,label:r}){return s.jsxs("g",{children:[s.jsx("rect",{x:t,y:e,width:a,height:o,rx:14,className:"fill-slate-50 stroke-slate-200"}),s.jsx("rect",{x:t,y:e,width:a,height:o,rx:14,fill:"none",className:"stroke-slate-300",strokeDasharray:"6 6"}),s.jsx("text",{x:t+12,y:e+20,className:"fill-slate-500 text-[12px]",children:r})]})}function ee({ids:t,label:e,pad:a=28,grow:o={left:0,right:0,top:0,bottom:0}}){const r=t.map(g=>P[g]).filter(Boolean);if(!r.length)return null;const l=r.map(g=>g.x),i=r.map(g=>g.y),y=Math.min(...l)-a-(o.left??0),m=Math.max(...l)+a+(o.right??0),b=Math.min(...i)-a-(o.top??0),p=Math.max(...i)+a+(o.bottom??0),O=m-y,T=p-b;return s.jsx(nt,{x:y,y:b,w:O,h:T,label:e})}function at({n:t}){const e=t.level??0,a=60*e;return s.jsxs("g",{children:[s.jsx("rect",{x:t.x-60,y:t.y-40,width:120,height:80,rx:12,className:"fill-white stroke-slate-300"}),s.jsx("rect",{x:t.x-45,y:t.y-25,width:90,height:50,rx:8,className:"fill-slate-100 stroke-slate-200"}),s.jsx("rect",{x:t.x-45,y:t.y-25+(50-a),width:90,height:a,className:"fill-sky-300/70"}),s.jsx("text",{x:t.x,y:t.y-50,textAnchor:"middle",className:"fill-slate-800 text-[12px] font-semibold",children:t.name}),s.jsxs("text",{x:t.x,y:t.y+38,textAnchor:"middle",className:"fill-slate-600 text-[11px]",children:["Nivel ",(e*100).toFixed(0),"% • ",t.capacity," m³"]})]})}function ot({n:t}){return s.jsxs("g",{children:[s.jsx("circle",{cx:t.x,cy:t.y,r:26,className:"fill-white stroke-slate-300"}),s.jsx(_e,{width:18,height:18,x:t.x-9,y:t.y-9,className:"stroke-slate-700"}),s.jsx("circle",{cx:t.x+27,cy:t.y-27,r:6,className:`stroke-white ${t.status==="on"?"fill-emerald-500":t.status==="standby"?"fill-amber-500":t.status==="fault"?"fill-rose-600":"fill-slate-400"}`}),s.jsx("text",{x:t.x,y:t.y+36,textAnchor:"middle",className:"fill-slate-800 text-[12px] font-semibold",children:t.name}),s.jsxs("text",{x:t.x,y:t.y+52,textAnchor:"middle",className:"fill-slate-600 text-[11px]",children:[t.kW," kW"]})]})}function rt({n:t}){const e=t.state==="open"?"fill-emerald-500":t.state==="closed"?"fill-rose-600":"fill-amber-500";return s.jsxs("g",{children:[s.jsx("rect",{x:t.x-16,y:t.y-10,width:32,height:20,rx:4,className:"fill-white stroke-slate-300"}),s.jsx("circle",{cx:t.x,cy:t.y,r:7,className:`stroke-white ${e}`}),s.jsxs("text",{x:t.x,y:t.y+26,textAnchor:"middle",className:"fill-slate-700 text-[11px]",children:[t.name," • ",t.state]})]})}function lt({n:t}){return s.jsxs("g",{children:[s.jsx("rect",{x:t.x-50,y:t.y-8,width:100,height:16,rx:6,className:"fill-slate-200 stroke-slate-300"}),s.jsx("text",{x:t.x,y:t.y-14,textAnchor:"middle",className:"fill-slate-600 text-[11px]",children:t.name})]})}function ve(t,e,a){const o=t.getBoundingClientRect(),r=t.viewBox.baseVal,l=(e-o.left)/o.width*r.width+r.x,i=(a-o.top)/o.height*r.height+r.y;return{x:l,y:i}}function it({id:t,enabled:e,snap:a=10,onChange:o,onEnd:r,debug:l}){const i=x.useRef(!1),y=x.useRef(0),m=x.useRef(0),b=x.useRef(null),p=x.useRef(null),O=f=>{p.current==null&&(p.current=requestAnimationFrame(()=>{p.current=null,f()}))},T=x.useCallback(f=>{if(!i.current||!b.current)return;const C=b.current,$=P[t];if(!$)return;const{x:_,y:E}=ve(C,f.clientX,f.clientY);let N=_+y.current,V=E+m.current;const I=Math.max(1,a);N=Math.round(N/I)*I,V=Math.round(V/I)*I;const G=C.viewBox.baseVal;N=Math.max(G.x+10,Math.min(G.x+G.width-10,N)),V=Math.max(G.y+10,Math.min(G.y+G.height-10,V)),$.x=N,$.y=V,o&&O(()=>o(N,V))},[t,a,o,l]),g=x.useCallback(f=>{i.current&&(i.current=!1,window.removeEventListener("pointermove",T,{passive:!0}),window.removeEventListener("pointerup",g,{passive:!0}),r==null||r())},[t,T,r,l]),F=x.useCallback(f=>{var N,V;if(!e)return;const C=f.currentTarget.ownerSVGElement||f.currentTarget;if(!C)return;b.current=C;const{x:$,y:_}=ve(C,f.clientX,f.clientY),E=P[t];y.current=((E==null?void 0:E.x)??0)-$,m.current=((E==null?void 0:E.y)??0)-_,i.current=!0,(V=(N=f.currentTarget).setPointerCapture)==null||V.call(N,f.pointerId),window.addEventListener("pointermove",T,{passive:!0}),window.addEventListener("pointerup",g,{passive:!0}),f.preventDefault()},[e,t,T,g,l]),M=x.useCallback(f=>{i.current&&T(f.nativeEvent)},[T]),Y=x.useCallback(f=>{g(f.nativeEvent)},[g]);return{onPointerDown:F,onPointerMove:M,onPointerUp:Y}}function we(t){switch(t){case"tank":return{halfW:60,halfH:40};case"pump":return{halfW:26,halfH:26};case"valve":return{halfW:16,halfH:10};case"manifold":return{halfW:50,halfH:8};default:return{halfW:24,halfH:24}}}const ke="acuaducto-layout-v1";function Ne(){return Object.values(P).map(t=>({id:t.id,x:t.x,y:t.y}))}function Ve(t){const e=new Map(t.map(a=>[a.id,a]));for(const a in P){const o=e.get(a);o&&(P[a].x=o.x,P[a].y=o.y)}}function se(){try{const t=JSON.stringify(Ne());localStorage.setItem(ke,t)}catch{}}function ct(){try{const t=localStorage.getItem(ke);if(!t)return!1;const e=JSON.parse(t);return Array.isArray(e)?(Ve(e),!0):!1}catch{return!1}}const ne=t=>{t.button===1&&(t.preventDefault(),t.stopPropagation())};function Pe(t=U){let e=1/0,a=1/0,o=-1/0,r=-1/0;for(const i of t){const{halfW:y,halfH:m}=we(i.type);e=Math.min(e,i.x-y),a=Math.min(a,i.y-m),o=Math.max(o,i.x+y),r=Math.max(r,i.y+m)}const l=120;return e-=l,a-=l,o+=l,r+=l,{minX:e,minY:a,maxX:o,maxY:r,w:o-e,h:r-a}}function dt(){const[t,e]=x.useState("Normal"),[a,o]=x.useState(!1),[r,l]=x.useState(0),i=tt(t),y=x.useRef(null),[m,b]=x.useState(()=>{const n=Pe();return{x:n.minX,y:n.minY,w:n.w,h:n.h}}),p=x.useRef(m);p.current=m;const O=x.useRef(null),T=()=>{O.current==null&&(O.current=requestAnimationFrame(()=>{l(n=>n+1),O.current=null}))},g=()=>{const n=Pe();b({x:n.minX,y:n.minY,w:n.w,h:n.h}),console.log("[App] fitToContent →",{vb:{x:n.minX,y:n.minY,w:n.w,h:n.h}})};function F(n,c,h){const A=y.current.getBoundingClientRect(),{x:v,y:B,w:L,h:R}=p.current,D=v+(c-A.left)/A.width*L,H=B+(h-A.top)/A.height*R,X=Math.pow(1.0015,n),j=Math.max(200,Math.min(5e4,L*X)),J=Math.max(200,Math.min(5e4,R*X)),Z=D-(D-v)*j/L,Q=H-(H-B)*J/R;b({x:Z,y:Q,w:j,h:J})}x.useEffect(()=>{console.groupCollapsed("[App] mount"),console.log("nodes",U.length,"edges",i.length,"scenario",t),console.groupEnd(),ct()&&(console.log("[App] layout cargado desde storage"),T()),g();const c=y.current;if(!c)return;const h=v=>{(v.ctrlKey||v.metaKey)&&(v.preventDefault(),F(v.deltaY,v.clientX,v.clientY))};c.addEventListener("wheel",h,{passive:!1});const k=new ResizeObserver(()=>{g()}),A=c.parentElement;return A&&k.observe(A),()=>{c.removeEventListener("wheel",h),k.disconnect()}},[]),x.useEffect(()=>{console.groupCollapsed("[App] scenario change"),console.log("scenario:",t),console.log("edges:",i.length),console.groupEnd()},[t,i.length]),x.useEffect(()=>{console.log("[App] viewBox",m)},[m]);const M=x.useRef({active:!1,start:{x:0,y:0},vb0:{x:0,y:0,w:0,h:0}});function Y(n){const c=y.current;n.preventDefault(),c.setPointerCapture(n.pointerId),M.current.active=!0,M.current.start={x:n.clientX,y:n.clientY},M.current.vb0=p.current}function f(n){if(!M.current.active)return;const h=y.current.getBoundingClientRect(),k=n.clientX-M.current.start.x,A=n.clientY-M.current.start.y,v=p.current.w/h.width,B=p.current.h/h.height,L=M.current.vb0.x-k*v,R=M.current.vb0.y-A*B;b(D=>({...D,x:L,y:R}))}function C(n){const c=y.current;try{c.releasePointerCapture(n.pointerId)}catch{}M.current.active=!1}const $=n=>{n.button===1&&Y(n)},_=n=>f(n),E=n=>C(n),N=n=>C(n),V=({id:n})=>{const c=P[n],{halfW:h,halfH:k}=we((c==null?void 0:c.type)??"tank"),[A,v]=x.useState(!1),B=it({id:n,enabled:a,snap:10,debug:!1,onChange:()=>{se(),T()},onEnd:()=>{v(!1),console.log("[Drag] end",n,"→",{x:P[n].x,y:P[n].y})}}),L=c.x-h-8,R=c.y-k-8,D=h*2+16,H=k*2+16,X=j=>{j.button!==1&&(v(!0),B.onPointerDown(j),console.log("[Drag] start",n))};return s.jsxs("g",{children:[A&&s.jsx("rect",{x:L-3,y:R-3,width:D+6,height:H+6,rx:10,fill:"none",stroke:"rgb(56 189 248)",strokeWidth:2,pointerEvents:"none"}),s.jsx("rect",{x:L,y:R,width:D,height:H,rx:8,fill:"black",fillOpacity:.04,pointerEvents:a?"all":"none",stroke:a?A?"rgb(56 189 248)":"rgb(203 213 225)":"none",strokeWidth:a?1.5:0,strokeDasharray:a?"4 4":void 0,style:{cursor:a?A?"grabbing":"grab":"default"},onPointerDown:X,onPointerMove:j=>B.onPointerMove(j),onPointerUp:j=>{v(!1),B.onPointerUp(j)},onPointerCancel:j=>{v(!1),B.onPointerUp(j)},onLostPointerCapture:()=>v(!1),onContextMenu:j=>j.preventDefault(),onAuxClick:ne})]})};function I(){console.log("[Layout] reset auto");const n=Ae(je);for(const c of n)P[c.id]&&(P[c.id].x=c.x,P[c.id].y=c.y);se(),T(),g()}function G(){const n=Ne();console.log("[Layout] export JSON",n);const c=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),h=URL.createObjectURL(c),k=document.createElement("a");k.href=h,k.download="layout-acueducto.json",k.click(),URL.revokeObjectURL(h)}function K(n){const c=new FileReader;c.onload=()=>{try{const h=JSON.parse(String(c.result));Ve(h),se(),T(),g(),console.log("[Layout] import OK",h)}catch(h){console.error("[Layout] import ERROR",h),alert("Archivo inválido")}},c.readAsText(n)}const z=x.useRef(null);return s.jsxs("div",{className:"min-h-screen w-full bg-slate-50",children:[s.jsx("style",{children:`
        @keyframes dash { to { stroke-dashoffset: -24; } }
        .flowing { stroke-dasharray: 4 8; animation: dash 1.4s linear infinite; opacity: 0.9; }
        text { user-select: none; }
      `}),s.jsx("div",{className:"sticky top-0 z-10 backdrop-blur supports-[backdrop-filter]:bg-white/60 bg-white/90 border-b border-slate-200",children:s.jsxs("div",{className:"mx-auto max-w-[1600px] px-6 py-3 flex flex-wrap items-center justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Xe,{className:"h-5 w-5 text-slate-700"}),s.jsx("h1",{className:"text-lg font-semibold text-slate-900",children:"Acuaducto — Vista General (hardcode)"})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[Object.keys(oe).map(n=>s.jsxs(q,{variant:t===n?"default":"outline",onClick:()=>e(n),title:`Escenario: ${n}`,children:[s.jsx(Ue,{className:"h-4 w-4"})," ",n]},n)),s.jsxs(q,{variant:a?"default":"outline",onClick:()=>o(n=>!n),title:"Mover nodos",children:[s.jsx(Fe,{className:"h-4 w-4"})," ",a?"Editando":"Editar"]}),s.jsxs(q,{variant:"outline",onClick:g,title:"Encajar todo (doble click en el lienzo)",children:[s.jsx(qe,{className:"h-4 w-4"})," Fit"]}),s.jsxs(q,{variant:"ghost",onClick:I,title:"Recalcular posiciones automáticamente",children:[s.jsx(ze,{className:"h-4 w-4"})," Reset"]}),s.jsx(q,{variant:"outline",onClick:G,title:"Exportar posiciones a JSON",children:"Exportar"}),s.jsxs("label",{className:"inline-flex",children:[s.jsx("input",{ref:z,type:"file",accept:"application/json",className:"hidden",onChange:n=>{var h;const c=(h=n.currentTarget.files)==null?void 0:h[0];c&&K(c),n.currentTarget.value=""}}),s.jsx(q,{variant:"outline",title:"Importar posiciones desde JSON",onClick:()=>{var n;return(n=z.current)==null?void 0:n.click()},children:"Importar"})]}),s.jsxs(q,{variant:"ghost",title:"Sólo demo visual, datos hardcodeados",children:[s.jsx(Ye,{className:"h-4 w-4"})," Demo"]})]})]})}),s.jsxs("div",{className:"mx-auto max-w-[1600px] px-6 py-6 space-y-6",children:[s.jsxs("div",{className:"rounded-2xl bg-white p-4 shadow-sm border border-slate-200",children:[s.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[s.jsx(Ke,{}),s.jsxs("div",{className:"text-sm text-slate-600",children:["Escenario: ",s.jsx("span",{className:"font-medium text-slate-900",children:t}),a&&s.jsx("span",{className:"ml-3 text-emerald-700 font-medium",children:"Modo edición"}),s.jsx("span",{className:"ml-3 text-slate-400",children:"Ctrl/⌘ + rueda = Zoom • Ruedita presionada = Pan • Doble clic = Fit"})]})]}),s.jsx("div",{className:"relative w-full overflow-hidden rounded-xl border border-slate-200",children:s.jsxs("svg",{ref:y,viewBox:`${m.x} ${m.y} ${m.w} ${m.h}`,className:"w-full h-[72vh] bg-white",style:{touchAction:"none"},onAuxClick:ne,onPointerDown:$,onPointerMove:_,onPointerUp:E,onPointerCancel:N,onDoubleClick:g,children:[s.jsxs("defs",{children:[s.jsx("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"8",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",children:s.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",className:"fill-current text-slate-400"})}),s.jsx("pattern",{id:"grid",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:s.jsx("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"#e5e7eb",strokeWidth:"1"})})]}),s.jsx("rect",{x:m.x-m.w*5,y:m.y-m.h*5,width:m.w*10,height:m.h*10,fill:"url(#grid)",onAuxClick:ne}),s.jsx(ee,{ids:["P1","P2","P3","P4","P5","P6","P7","MC"],label:"Planta",pad:36,grow:{right:30,top:10,bottom:14}}),s.jsx(ee,{ids:["TP","TA","P8","P9","MB"],label:"Tanques principales",pad:34,grow:{left:12}}),s.jsx(ee,{ids:["TA1","TA2","TA3"],label:"Tanques altos",pad:30}),s.jsx(ee,{ids:["VG","TG"],label:"Distribución por gravedad",pad:28,grow:{right:20}}),i.map(n=>s.jsx(st,{...n},`${n.a}-${n.b}-${r}`)),U.map(n=>{const c=n.type==="tank"?s.jsx(at,{n},n.id):n.type==="pump"?s.jsx(ot,{n},n.id):n.type==="valve"?s.jsx(rt,{n},n.id):n.type==="manifold"?s.jsx(lt,{n},n.id):null;return s.jsxs("g",{children:[c,s.jsx(V,{id:n.id})]},`wrap-${n.id}`)})]})}),s.jsx("div",{className:"mt-3 text-sm text-slate-700",children:oe[t].note})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm",children:[s.jsxs("div",{className:"mb-2 flex items-center gap-2 text-slate-800 font-semibold",children:[s.jsx(Ie,{className:"h-4 w-4"})," Estado de Bombas"]}),s.jsx("ul",{className:"space-y-2 text-sm",children:U.filter(n=>n.type==="pump").map(n=>s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`inline-block h-2.5 w-2.5 rounded-full ${n.status==="on"?"bg-emerald-500":n.status==="standby"?"bg-amber-500":n.status==="fault"?"bg-rose-600":"bg-slate-400"}`}),n.name]}),s.jsxs("span",{className:"text-slate-600",children:[n.kW," kW"]})]},n.id))})]}),s.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm",children:[s.jsxs("div",{className:"mb-2 flex items-center gap-2 text-slate-800 font-semibold",children:[s.jsx(He,{className:"h-4 w-4"})," Niveles de Tanque"]}),s.jsx("ul",{className:"space-y-2 text-sm",children:U.filter(n=>n.type==="tank").map(n=>s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{children:n.name}),s.jsxs("span",{className:"tabular-nums font-medium",children:[((n.level??0)*100|0).toString(),"%"]})]},n.id))})]}),s.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm",children:[s.jsxs("div",{className:"mb-2 flex items-center gap-2 text-slate-800 font-semibold",children:[s.jsx(Je,{className:"h-4 w-4"})," Alarmas (demo)"]}),s.jsxs("ul",{className:"space-y-2 text-sm",children:[s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{children:"P7 fuera de servicio"}),s.jsx("span",{className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs bg-rose-100 text-rose-700",children:"Crítica"})]}),s.jsxs("li",{className:"flex items-center justify-between",children:[s.jsx("span",{children:"V-TA3 en estrangulación"}),s.jsx("span",{className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs bg-amber-100 text-amber-800",children:"Atención"})]})]})]})]})]})]})}ae.createRoot(document.getElementById("root")).render(s.jsx(Ce.StrictMode,{children:s.jsx(dt,{})}));
//# sourceMappingURL=index-Co5DzYtY.js.map
